<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start</title>

    <link rel="stylesheet" href="styles/style.css">
    <!-- FIX FOR FAVICON.ICO -->
    <link rel="shortcut icon" href="#">
</head>

<body>
    <!-- Header -->
    <%- include('partials/header.ejs') %>


    <main>
        <h1>Hello</h1>

        <div id="testBox">
            <% locals.events.forEach(ele => { %>

            <div class="eventDiv">
                <span class="event-title"><%- ele.title %></span>
                <span class="event-date"><%- ele.date %></span>
                <button class="edit-button" data-id="<%= ele.id %>">Edit</button>
                
            </div>

            <% }); %>
        </div>

        <form action="/index" method="post">
            <label for="title">Title</label>
            <input type="text" name="title" id="title">
            <label for="date">Date</label>
            <input type="text" name="date" id="date">
            <button type="submit">Create</button>
        </form>

        <div class="container">
            <div class="wrapper">

                <ul class="day-card">
                    <h2>MONDAY</h2>
                    <p> title placeholder </p>
                    <li class="event-card">
                        <p class="testtest">date placeholder</p>
                    </li>
                    <button type="submit">Add event</button>

                </ul>
                <ul class="day-card active">
                    <h2>TUESDAY</h2>
                    <p> title placeholder </p>
                    <li class="event-card">
                        <p class="testtest">date placeholder</p>
                    </li>
                </ul>

            </div>
        </div>
    </main>

    <!-- Footer -->
    <%- include('partials/footer.ejs') %>

    <!-- <script>
        const form = document.querySelector("form");
        form.addEventListener("submit", (event) => {
            event.preventDefault();
        });
    </script> -->

    <script>
        async function deleteEvent(id) {
            console.log("delete test");
        }



        async function editEvent(evt) {
        // const id = Number(evt.target.dataset.id); // data-id -> dataset.id


        const container = evt.target.parentElement;
        const id = container.querySelector(".edit").getAttribute("data-id");
        const titleEl = container.querySelector(".event-title");
        const dateEl = container.querySelector(".event-date");
        // if not editable make them editable
        if (!titleEl.isContentEditable && !dateEl.isContentEditable) {
          titleEl.contentEditable = true;
          dateEl.contentEditable = true;
          // clicking the same button should save the changes
          evt.target.innerText = "Save";
        } else {
          // Second time clicked it should save changes
          // reset element to be non editable
          titleEl.contentEditable = false;
          dateEl.contentEditable = false;
          evt.target.innerText = "Edit";
          // Look at values of titleEl and qudate and submit new quote
          const newQuote = {
            title: titleEl.innerText,
            quote: qudate.innerText,
          };
          const response = await fetch(`/events/${id}`, {
            method: "put",
            body: JSON.stringify(newQuote),
            headers: {
              "Content-Type": "application/json",
            },
          });
          
          // Check if there is a redirect to follow the new url
          if (response.redirected) {
            window.location.href = response.url;
          }
        }
      }
      document
        .querySelectorAll(".edit-button")
        .forEach((btn) => (btn.onclick = editEvent));
    </script>


</body>
</html>